language: android

jdk:
  - oraclejdk8

before_install:
  - gem install fir-cli

android:
  components:
    - tools
    - build-tools-25.0.0
    - android-25

script:
- "./gradlew build"

after_script:
- cd app
- git init
- git config user.name "$username"
- git config user.email "$useremail"
- git add .
- git commit -m "Build"
- git push --force --quiet "https://${GH_TOKEN}@${GH_REF}" master:Build-app

branches:
  only:
    - master

before_deploy:
  - export APK_PATH=$(ls app/build/outputs/apk/*-release-unsigned.apk)

deploy:
  provider: releases
  api_key:
    secure: $GITHUB_TRAVIS
  file: $APK_PATH
  skip_cleanup: true
  on:
    repo: Ezalor/Unblock163MusicClient-Xposed
    tags: true

after_deploy:
    - fir p $APK_PATH -T $FIR_TOKEN

